
<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>나만의 쇼츠 플레이어</title>
    <meta property="og:title" content="나만의 쇼츠 플레이어"/>
    <meta property="og:description" content="최신 쇼츠를 연속으로 재생합니다"/>
    <meta property="og:image" content=""/>
    <meta property="og:url" content=""/>
    <style>
        :root { --desktop-player-width: 340px; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: sans-serif; }
        
        /* 모바일 기본 스타일 */
        body { background-color: #000; overflow: hidden; }
        #mobile-view { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        #mobile-player-container { position: relative; width: 100%; height: 100%; }
        #mobile-player { width: 100%; height: 100%; max-width: calc(100vh * 9 / 16); margin: auto; }
        #touchOverlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 5; }
        #unmuteButton { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 15px 25px; font-size: 18px; font-weight: bold; color: white; background: rgba(0, 0, 0, 0.7); border: 2px solid rgba(255, 255, 255, 0.8); border-radius: 30px; cursor: pointer; z-index: 10; backdrop-filter: blur(10px); display: none; }
        #desktop-view { display: none; }

        /* 데스크톱 스타일 (768px 이상) */
        @media (min-width: 768px) {
            body { background-color: #f1f1f1; overflow-y: auto; }
            #mobile-view { display: none; }
            #desktop-view { display: block; padding: 20px 0; }
            .desktop-player-wrapper {
                position: relative;
                width: var(--desktop-player-width);
                height: calc(var(--desktop-player-width) * 16 / 9);
                margin: 0 auto 20px auto;
                background-color: #000;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }
            .desktop-player { width: 100%; height: 100%; }
        }
    </style>
</head>
<body>

    <div id="mobile-view">
        <div id="mobile-player-container">
            <div id="mobile-player"></div>
        </div>
        <div id="touchOverlay"></div>
        <button id="unmuteButton">🔊 소리 켜기</button>
    </div>

    <div id="desktop-view">
        </div>

<script>
    const videoIds = ["-YiDNUrMX6Y","xKVQ0i3jQoo","NJYtmcWV5ks","bWx1SjACMFU"];
    const SETTINGS = {
        enableControls: true,
        enableSwipe: true,
        enableLoop: true
    };
    let players = {}; // 여러 플레이어를 관리하기 위한 객체
    let currentMobileIndex = 0;
    
    function onYouTubeIframeAPIReady() {
        if (!videoIds || videoIds.length === 0) {
            document.body.innerHTML = "<h1 style='color: #333; text-align: center; padding-top: 50px;'>재생할 영상이 없습니다.</h1>";
            return;
        }

        if (window.matchMedia('(min-width: 768px)').matches) {
            setupDesktopView();
        } else {
            setupMobileView();
        }
    }

    // --- 모바일 뷰 설정 ---
    function setupMobileView() {
        const playerVars = { 'autoplay': 1, 'mute': 1, 'rel': 0, 'playsinline': 1, 'controls': 0 };
        if (SETTINGS.enableLoop) {
            playerVars.loop = 1;
            playerVars.playlist = videoIds[0]; // 단일 영상 루프
        }

        players['mobile'] = new YT.Player('mobile-player', {
            height: '100%', width: '100%',
            videoId: videoIds[0],
            playerVars: playerVars,
            events: { 'onReady': onMobilePlayerReady, 'onStateChange': onMobilePlayerStateChange }
        });
    }

    function onMobilePlayerReady(event) {
        const unmuteBtn = document.getElementById('unmuteButton');
        unmuteBtn.style.display = 'block';
        unmuteBtn.addEventListener('click', () => {
            players['mobile'].unMute();
            unmuteBtn.style.display = 'none';
        });
        if (SETTINGS.enableSwipe) setupSwipeListeners();
    }

    function onMobilePlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING && !players['mobile'].isMuted()) {
            document.getElementById('unmuteButton').style.display = 'none';
        } else if (event.data === YT.PlayerState.ENDED && !SETTINGS.enableLoop) {
            playNextMobile();
        }
    }
    
    function playNextMobile() {
        if (videoIds.length <= 1) return;
        currentMobileIndex = (currentMobileIndex + 1) % videoIds.length;
        players['mobile'].loadVideoById(videoIds[currentMobileIndex]);
    }

    function playPrevMobile() {
        if (videoIds.length <= 1) return;
        currentMobileIndex = (currentMobileIndex - 1 + videoIds.length) % videoIds.length;
        players['mobile'].loadVideoById(videoIds[currentMobileIndex]);
    }

    function setupSwipeListeners() {
        const container = document.getElementById('touchOverlay');
        let startY = 0;
        container.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, { passive: true });
        container.addEventListener('touchend', e => {
            const deltaY = startY - e.changedTouches[0].clientY;
            if (Math.abs(deltaY) > 50) {
                if (deltaY > 0) playNextMobile(); else playPrevMobile();
            }
        }, { passive: true });
    }

    // --- 데스크톱 뷰 설정 ---
    function setupDesktopView() {
        const desktopContainer = document.getElementById('desktop-view');
        videoIds.forEach((id, index) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'desktop-player-wrapper';
            wrapper.dataset.videoId = id;
            wrapper.dataset.playerIndex = index;
            
            const playerDiv = document.createElement('div');
            playerDiv.id = 'desktop-player-' + index;
            playerDiv.className = 'desktop-player';
            
            wrapper.appendChild(playerDiv);
            desktopContainer.appendChild(wrapper);
        });

        const observer = new IntersectionObserver(handleIntersection, { threshold: 0.6 });
        document.querySelectorAll('.desktop-player-wrapper').forEach(wrapper => observer.observe(wrapper));
    }

    let lastPlayed = null;
    function handleIntersection(entries) {
        entries.forEach(entry => {
            const index = entry.target.dataset.playerIndex;
            if (entry.isIntersecting) {
                if (lastPlayed && lastPlayed !== players[index]) {
                   if (players[lastPlayed.id]) players[lastPlayed.id].pauseVideo();
                }

                if (players[index]) {
                    players[index].playVideo();
                } else {
                    createDesktopPlayer(index);
                }
                lastPlayed = {id: index, player: players[index]};
            } else {
                if (players[index]) {
                    players[index].pauseVideo();
                }
            }
        });
    }

    function createDesktopPlayer(index) {
        const videoId = videoIds[index];
        players[index] = new YT.Player('desktop-player-' + index, {
            height: '100%', width: '100%',
            videoId: videoId,
            playerVars: {
                'autoplay': 1, 'mute': 0, 'rel': 0, 
                'playsinline': 1, 'controls': SETTINGS.enableControls ? 1 : 0
            },
            events: { 'onStateChange': onDesktopPlayerStateChange }
        });
    }

    function onDesktopPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
            const currentPlayerId = event.target.getIframe().id; // "desktop-player-0"
            const currentIndex = parseInt(currentPlayerId.split('-')[2]);
            let nextIndex = currentIndex + 1;

            if (nextIndex >= videoIds.length) {
                if (SETTINGS.enableLoop) {
                    nextIndex = 0; // 전체 목록 반복
                } else {
                    return; // 반복 안 함
                }
            }
            
            const nextPlayerWrapper = document.querySelector(`[data-player-index="${nextIndex}"]`);
            if (nextPlayerWrapper) {
                nextPlayerWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    }

</script>
<script async src="https://www.youtube.com/iframe_api"></script>
</body>
</html>